image: "python:3.7"

before_script:
  - python --version
  - pip install -r requirements.txt

stages:
  - Static Analysis
  - Test
  - Create Image

pylint:
  stage: Static Analysis
  allow_failure: true
  script:
  - pylint main.py

unittests:
  stage: Test
  allow_failure: true
  script:
  - python test.py

Build Push:
  stage: Create Image
  image: docker:19.03.12
  services:
    - name: docker:19.03.12-dind
  before_script:
    - docker info
  script:
    - docker login -u $REGISTRY_USER -p $REGISTRY_PASSWORD $REGISTRY_URL
    - docker build -t quay.io/faresherhar/testapi .
    - docker push quay.io/faresherhar/testapi
